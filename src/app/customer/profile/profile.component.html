<section class="profile-container">
  <app-loading *ngIf="loading()"></app-loading>

  <div *ngIf="!loading() && user() && !isEditing()" class="user-profile">
    <app-title size="h1" title="Perfil"></app-title>

    <p><strong>Nome:</strong> {{ user()?.name }}</p>
    <p><strong>Email:</strong> {{ user()?.email }}</p>

    <p *ngIf="user()?.cell_phone">
      <strong>Telefone:</strong> {{ user()?.cell_phone }}
    </p>

    <button class="primary-btn" (click)="enableEdit()">
      Editar perfil
    </button>

    <p *ngIf="!user()?.isConfirmed" class="warning">
      É necessário verificar sua conta,
      <span class="link" (click)="openModal()">clique aqui</span>
    </p>
  </div>

  <form
    *ngIf="!loading() && isEditing()"
    [formGroup]="profileForm"
    class="edit-form"
  >
    <app-title size="h2" title="Editar perfil"></app-title>

    <app-primary-input
      formControlName="name"
      label="Nome"
      inputName="name"
    ></app-primary-input>

    <app-primary-input
      formControlName="email"
      label="Email"
      inputName="email"
    ></app-primary-input>

    <app-primary-input
      formControlName="passowrd"
      label="Nova senha"
      type="password"
      inputName="password"
      placeholder="Deixe em branco para não alterar"
    ></app-primary-input>

    <app-primary-input
      formControlName="passwordConfirm"
      label="Confirme a nova senha"
      type="password"
      inputName="confirmPassword"
    ></app-primary-input>

    <div *ngIf="profileForm.errors?.['passwordWeak']" class="error">
      A senha deve conter ao menos 6 caracteres, uma letra maiúscula e uma minúscula.
    </div>

    <div *ngIf="profileForm.errors?.['passwordMismatch']" class="error">
      As senhas não conferem.
    </div>

    <app-primary-input
      formControlName="cell_phone"
      label="Telefone"
      inputName="cell_phone"
      placeholder="(11) 99999-9999"
    ></app-primary-input>

    <div class="actions">
      <button type="button" class="secondary-btn" (click)="cancelEdit()">
        Cancelar
      </button>

      <button
        type="button"
        class="primary-btn"
        [disabled]="profileForm.invalid"
        (click)="saveProfile()"
      >
        Salvar alterações
      </button>
    </div>
  </form>
</section>

<default-modal
  *ngIf="isModalOpen"
  title="Valide sua conta"
  (close)="closeModal()"
>
  <p>
    Para solicitar um novo código,
    <button
      type="button"
      class="link-button"
      (click)="sendCodeVerificationByEmail()"
    >
      clique aqui!
    </button>
  </p>

  <form [formGroup]="verificationForm" (ngSubmit)="submitVerification()">
    <app-primary-input
      formControlName="verificationCode"
      label="Código de verificação"
      inputName="verificationCode"
      placeholder="XXXXXX"
      [maxLength]="6"
    ></app-primary-input>

    <div
      *ngIf="
        verificationForm.get('verificationCode')?.invalid &&
        (verificationForm.get('verificationCode')?.dirty ||
          verificationForm.get('verificationCode')?.touched)
      "
      class="error"
    >
      Código inválido.
    </div>

    <button type="submit" [disabled]="verificationForm.invalid">
      Enviar
    </button>
  </form>
</default-modal>
